<section ng-controller="HomeVictoryController">
    <div class="row">
        <div homepage-announcement></div>
    </div>
    <div class="row center-align">
        <h1 class="header-no-margin">
            Alert Statistics
        </h1>
        <h4>
            Statistics shown from 29-Oct-2014 to {{today | date : 'dd-MMM-yyyy'}}
        </h4>
    </div>
    <div class="row">
        <div class="col s12">
            <territory-bar
                vs="{{alertStats.totals.alerts.vs}}"
                nc="{{alertStats.totals.alerts.nc}}"
                tr="{{alertStats.totals.alerts.tr}}"
                draw="{{alertStats.totals.alerts.draw}}"
                total="{{alertStats.totals.alerts.total}}"
                decimal="1">
            </territory-bar>
        </div>
    </div>
    <div class="row row-no-margin">
        <div class="col s12 no-padding">
            <div
                metric-card
                class="col s12 m6"
                card-title="Total Alerts"
                metric="{{alertStats.totals.alerts.total}}">
            </div>
            <div
                metric-card
                class="col s12 m6"
                card-title="Total Dominations"
                metric="{{alertStats.totals.dominations.total}}">
            </div>
            <div
                home-faction-card
                class="col s12 m3"
                card-class="vs-card"
                card-title="Vanu Sovereignty"
                faction="vs">
            </div>
            <div
                home-faction-card
                class="col s12 m3"
                card-class="nc-card"
                card-title="New Conglomerate"
                faction="nc">
            </div>
            <div
                home-faction-card
                class="col s12 m3"
                card-class="tr-card"
                card-title="Terran Republic"
                faction="tr">
            </div>
            <div
                home-faction-card
                class="col s12 m3"
                card-class="draw-card"
                card-title="Draws"
                faction="draw">
            </div>
        </div>
    </div>

    <div ng-controller="HomeTimelineController" class="row">
        <h1 class="center-align">
            Victory Timeline
        </h1>
        <div class="col s12" ng-show="!loadedTimeline">
            <div class="sk-three-bounce" id="alert-timeline-placeholder">
                <p class="caption">
                    <i class="fa fa-refresh fa-spin fa-3x"></i><br />
                    Loading Victory Timeline...
                </p>
            </div>
        </div>

        <div id="alert-timeline"></div>
    </div>

    <h1 class="center-align">
        Continent &amp; Server Victory Breakdowns
    </h1>

    <div class="col s12 m6 no-padding">
        <div class="col s12">
            <div class="card blue-grey darken-3">
                <div class="card-content">
                    <div class="row">
                        <h2 class="center-align">
                            Global Server Victories
                        </h2>
                        <p class="center-align caption">
                            <i class="fa fa-info-circle"></i> Breakdown of each faction's victories on a per-server basis
                        </p>
                    </div>
                    <div ng-repeat="(server, metrics) in alertStats.victories">
                        <div class="row">
                            <div class="col s4 m2">
                                {{::config.serverNames[server]}}
                            </div>
                            <div class="col s8 m10">
                                <territory-bar
                                    vs="{{metrics.vs}}"
                                    nc="{{metrics.nc}}"
                                    tr="{{metrics.tr}}"
                                    draw="{{metrics.draw}}"
                                    total="{{metrics.vs + metrics.nc + metrics.tr + metrics.draw}}"
                                    decimal="1">
                                </territory-bar>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <section ng-controller="HomeZoneVictoryController">
        <div class="col s12 m6 no-padding">
            <div class="col s12">
                <div class="card blue-grey darken-3">
                    <div class="card-content">
                        <div class="row">
                            <h2 class="center-align">
                                Global Continent Victories
                            </h2>
                            <p class="center-align caption">
                                <i class="fa fa-info-circle"></i> Breakdown of each faction's victories on a per-continent basis
                            </p>
                        </div>

                        <div ng-repeat="(zone, metrics) in zoneStats.zoneTotals">
                            <div class="row">
                                <div class="col s4 m2">
                                    {{::config.zoneNames[zone]}}
                                </div>
                                <div class="col s8 m10">
                                    <territory-bar
                                        vs="{{metrics.vs}}"
                                        nc="{{metrics.nc}}"
                                        tr="{{metrics.tr}}"
                                        draw="{{metrics.draw}}"
                                        total="{{metrics.vs + metrics.nc + metrics.tr + metrics.draw}}"
                                        decimal="1">
                                    </territory-bar>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col s12 m12 no-padding">
            <div class="col s12">
                <div class="card blue-grey darken-3">
                    <div class="card-content">
                        <div class="row">
                            <h2 class="center-align">
                                Per-Server Continental Victories
                            </h2>
                            <p class="center-align caption">
                                <i class="fa fa-info-circle"></i> Shows the breakdown of each Server's victories by Continent. Hover over each segment for exact number of wins.
                            </p>
                        </div>
                        <div class="row row-no-margin">
                            <div class="col s2 m1">
                                <div ng-repeat="(key, server) in config.servers">
                                    {{config.serverNames[server]}}
                                </div>
                            </div>
                            <div class="col s10 m11 segments-small" id="server-zone-breakdown">
                                <div ng-repeat="(zones, servers) in zoneStats.zones" class="col s12 m3">
                                    <div ng-repeat="(key, metrics) in servers">
                                        <territory-bar
                                            vs="{{metrics.vs}}"
                                            nc="{{metrics.nc}}"
                                            tr="{{metrics.tr}}"
                                            draw="{{metrics.draw}}"
                                            total="{{metrics.vs + metrics.nc + metrics.tr + metrics.draw}}"
                                            decimal="1">
                                        </territory-bar>
                                    </div>
                                    <p class="center-align caption">
                                        {{::config.zoneNames[zones]}}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col s12 m12 no-padding">
            <div class="col s12">
                <div class="card blue-grey darken-3">
                    <div class="card-content">
                        <div class="row">
                            <h2 class="center-align">
                                Faction Victory Contribution by Server
                            </h2>
                            <p class="center-align caption">
                                <i class="fa fa-info-circle"></i> Shows the contribution of each server to their factions's victories. Hover over (or tap on mobile) each segment for more detail.
                            </p>
                        </div>
                        <div class="row">
                            <div class="col s12" id="faction-victory-breakdown">
                                <div class="territory-bar z-depth-1 grey darken-3">
                                    <div class="loading" ng-hide="loaded">
                                        <i class="fa fa-refresh fa-spin"></i>
                                    </div>
                                    <div
                                        ng-repeat="(faction, servers) in zoneStats.serverEmpireStats"
                                        class="segment {{faction}}-segment segments-small"
                                        style="width: {{zoneStats.serverEmpireTotals[faction] / zoneStats.serverEmpireTotals.all * 100 | number: 2}}%"
                                        ng-hide="!loaded">
                                        <div
                                            ng-repeat="(server, data) in servers"
                                            class="faction-contribution-segment segment-metric tooltipped"
                                            style="width: {{data.value / zoneStats.serverEmpireTotals[faction] * 100 | number: 2}}%"
                                            data-tooltip="{{config.serverNames[data.server]}} | {{data.value}} | {{data.value / zoneStats.serverEmpireTotals[faction] * 100 | number: 2}}% of faction victories"
                                            ng-if="server != 'total'">
                                            <span ng-if="faction != 'draw'">{{data.value}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" id="faction-victory-tables">
                            <div class="col s12 m3" ng-repeat="(faction, servers) in zoneStats.serverEmpireStats">
                                <div class="row header-row">
                                    <h3 class="center-align">
                                        {{faction | uppercase}} Contributions
                                    </h3>
                                    <div class="col s4">
                                        Server
                                    </div>
                                    <div class="col s4 center-align">
                                        Wins
                                    </div>
                                    <div class="col s4 center-align">
                                        %
                                    </div>
                                    <hr />
                                </div>
                                <div
                                    class="row metric-row"
                                    ng-repeat="value in servers"
                                    ng-if="server != 'total'">
                                    <div class="col s4">
                                        {{config.serverNames[value.server]}}
                                    </div>
                                    <div class="col s4 center-align">
                                        {{value.value}}
                                    </div>
                                    <div class="col s4 center-align">
                                        {{value.value / zoneStats.serverEmpireTotals[faction] * 100 | number: 1}}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</section>
